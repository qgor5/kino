<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />

  <!-- SEO и соцсети -->
  <meta name="description" content="Смотрите трейлеры лучших и популярных фильмов, узнавайте о новинках и рейтингах. Подборка самых свежих кинотрейлеров.">
  <meta name="keywords" content="трейлеры фильмов, смотреть трейлеры, новинки кино, рейтинг фильмов, лучшие трейлеры, TopKino">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="TopKino — Детали фильма" />
  <meta property="og:description" content="Смотрите трейлеры фильмов, узнавайте новинки кино и рейтинги. Подборка лучших трейлеров на TopKino." />
  <meta property="og:image" content="https://topkino.netlify.app/logo.png" />
  <meta property="og:url" content="https://topkino.netlify.app/" />
  <meta name="twitter:card" content="summary_large_image" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TopKino — Детали фильма</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 15px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    a {
      color: #00aaff;
      text-decoration: none;
      display: inline-block;
      margin-bottom: 20px;
      font-weight: 600;
    }

    a:hover {
      text-decoration: underline;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .search-container {
      flex-grow: 1;
      max-width: 400px;
    }

    input[type="search"] {
      width: 100%;
      padding: 8px 12px;
      border-radius: 25px;
      border: none;
      font-size: 1rem;
      outline: none;
      box-shadow: 0 0 6px #00aaffaa;
      color: #111;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .poster {
      width: 300px;
      flex-shrink: 0;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .details {
      flex: 1;
      min-width: 280px;
    }

    iframe {
      width: 100%;
      height: 300px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
    }

    .similar-movies {
      margin-top: 40px;
    }

    .similar-movies h2 {
      margin-bottom: 15px;
      color: #00aaff;
      font-weight: 700;
    }

    .similar-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 15px;
    }

    .similar-movie-card {
      background: #222;
      border-radius: 8px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 0 8px #00aaff66;
      cursor: pointer;
      transition: transform 0.3s;
      color: #eee;
      text-decoration: none;
      font-size: 0.9rem;
    }

    .similar-movie-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #00ccffcc;
    }

    .similar-movie-card img {
      width: 100%;
      height: 190px;
      object-fit: cover;
      display: block;
    }

    .similar-movie-title {
      padding: 8px 6px;
      min-height: 44px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        align-items: center;
      }

      .poster {
        width: 100%;
        max-width: 400px;
      }

      .details {
        width: 100%;
      }

      iframe {
        height: 220px;
      }
    }

  </style>
</head>
<body>

  <header>
    <a href="index.html">← Назад к списку фильмов</a>
    <div class="search-container">
      <input id="search-input" type="search" placeholder="Поиск фильма по названию..." />
    </div>
  </header>

  <div class="container">
    <img class="poster" src="" alt="Постер фильма" />
    <div class="details">
      <h1 class="title"></h1>
      <p class="description"></p>
    </div>
  </div>

  <iframe id="trailer" src="" allowfullscreen></iframe>

  <section class="similar-movies" id="similar-movies" style="display:none;">
    <h2>Похожие фильмы</h2>
    <div class="similar-list" id="similar-list"></div>
  </section>

  <script>
    const API_KEY = '7cb67565ace3a08cd9d099c749787121';
    const IMG_URL = 'https://image.tmdb.org/t/p/w500';

    // Получаем id из URL вида /movie/157336-interstellar.html
    const pathParts = window.location.pathname.split('/');
    const lastPart = pathParts[pathParts.length - 1];
    const withoutExt = lastPart.replace('.html', '');
    const movieId = withoutExt.split('-')[0];

    async function loadMovieDetails() {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}&language=ru-RU`);
      const movie = await res.json();

      document.querySelector('.poster').src = movie.poster_path
        ? IMG_URL + movie.poster_path
        : 'https://via.placeholder.com/300x450?text=Нет+постера';

      document.querySelector('.title').textContent = `${movie.title} (${movie.release_date?.slice(0, 4) || ''})`;
      document.querySelector('.description').textContent = movie.overview || 'Описание недоступно.';
    }

    async function loadTrailer() {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${API_KEY}&language=ru-RU`);
      const data = await res.json();
      const trailer = data.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');

      if (trailer) {
        document.getElementById('trailer').src = `https://www.youtube.com/embed/${trailer.key}`;
      }
    }

    async function loadSimilarMovies() {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/similar?api_key=${API_KEY}&language=ru-RU&page=1`);
      const data = await res.json();

      if (data.results && data.results.length > 0) {
        const container = document.getElementById('similar-list');
        container.innerHTML = '';

        data.results.forEach(movie => {
          const seoTitle = transliterate(movie.title);
          const movieCard = document.createElement('a');
          movieCard.href = `movie/${movie.id}-${seoTitle}.html`;
          movieCard.className = 'similar-movie-card';
          movieCard.title = movie.title;
          movieCard.innerHTML = `
            <img src="${movie.poster_path ? IMG_URL + movie.poster_path : 'https://via.placeholder.com/300x450?text=Нет+постера'}" alt="${movie.title}">
            <div class="similar-movie-title">${movie.title}</div>
          `;
          container.appendChild(movieCard);
        });

        document.getElementById('similar-movies').style.display = 'block';
      }
    }

    // Простая транслитерация для url
    function transliterate(str) {
      const ru = ['а','б','в','г','д','е','ё','ж','з','и','й','к','л','м','н','о','п','р','с','т','у','ф','х','ц','ч','ш','щ','ъ','ы','ь','э','ю','я',' '];
      const en = ['a','b','v','g','d','e','e','zh','z','i','y','k','l','m','n','o','p','r','s','t','u','f','h','ts','ch','sh','sch','','y','','e','yu','ya','-'];
      return str.toLowerCase().split('').map((char) => {
        const index = ru.indexOf(char);
        return index >= 0 ? en[index] : char;
      }).join('').replace(/[^a-z0-9\-]/g, '');
    }

    // Поиск по названию фильма (перенаправляем на главную с параметром ?search=)
    document.getElementById('search-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const query = e.target.value.trim();
        if (query.length > 0) {
          // Пример: перейти на главную с параметром поиска
          window.location.href = `index.html?search=${encodeURIComponent(query)}`;
        }
      }
    });

    // Загрузка данных
    loadMovieDetails();
    loadTrailer();
    loadSimilarMovies();
  </script>

</body>
</html>
