<div id="posts-container" class="posts-grid"></div>

<script>
  const API_KEY = '7cb67565ace3a08cd9d099c749787121';
  const IMG_URL = 'https://image.tmdb.org/t/p/w300';

  // Подгрузка фильмов
  async function loadUpcomingMovies() {
    const res = await fetch(`https://api.themoviedb.org/3/movie/upcoming?api_key=${API_KEY}&language=ru-RU&page=1`);
    return (await res.json()).results;
  }

  // Подгрузка сериалов в эфире
  async function loadOnAirTV() {
    const res = await fetch(`https://api.themoviedb.org/3/tv/on_the_air?api_key=${API_KEY}&language=ru-RU&page=1`);
    return (await res.json()).results;
  }

  // Фильтрация анимационных фильмов среди новинок (Animation жанр id=16)
  async function loadUpcomingAnimations() {
    const movies = await loadUpcomingMovies();
    return movies.filter(movie => movie.genre_ids.includes(16));
  }

  function createPostElement(item, type) {
    const title = type === 'tv' ? item.name : item.title;
    const date = item.release_date || item.first_air_date || 'Дата неизвестна';
    const year = date.slice(0, 4);
    const overview = item.overview || '';
    const slug = title.toLowerCase().replace(/[^a-zа-яё0-9]+/gi, '-');
    const link = `/${item.id}-${slug}.html`;

    const el = document.createElement('article');
    el.className = 'post-card';
    el.innerHTML = `
      <a href="${link}" title="${title}">
        <img src="${item.poster_path ? IMG_URL + item.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" alt="Постер ${title}" class="post-image" />
        <h2 class="post-title">${title} (${year})</h2>
        <p class="post-excerpt">${overview.length > 150 ? overview.slice(0,150) + '...' : overview}</p>
        <p class="post-type">${type === 'movie' ? 'Фильм' : type === 'tv' ? 'Сериал' : 'Мультфильм'}</p>
      </a>
    `;
    return el;
  }

  async function loadAll() {
    const container = document.getElementById('posts-container');
    container.innerHTML = '';

    // Заголовки секций
    const sections = [
      { title: 'Новинки фильмов', items: await loadUpcomingMovies(), type: 'movie' },
      { title: 'Новинки сериалов', items: await loadOnAirTV(), type: 'tv' },
      { title: 'Новинки мультфильмов', items: await loadUpcomingAnimations(), type: 'animation' }
    ];

    for (const section of sections) {
      const header = document.createElement('h2');
      header.textContent = section.title;
      header.style.color = '#00aaff';
      header.style.marginTop = '40px';
      container.appendChild(header);

      const grid = document.createElement('div');
      grid.style.display = 'flex';
      grid.style.flexWrap = 'wrap';
      grid.style.gap = '20px';
      grid.style.justifyContent = 'center';

      section.items.slice(0, 7).forEach(item => {
        const postEl = createPostElement(item, section.type === 'animation' ? 'movie' : section.type);
        grid.appendChild(postEl);
      });

      container.appendChild(grid);
    }
  }

  loadAll();
</script>

<style>
  #posts-container {
    max-width: 1200px;
    margin: auto;
    padding: 15px;
  }
  .post-card {
    background: #222;
    border-radius: 8px;
    width: 300px;
    padding: 10px;
    box-sizing: border-box;
    color: #eee;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
    transition: transform 0.2s ease;
    user-select: none;
  }
  .post-card:hover {
    transform: translateY(-5px);
  }
  .post-image {
    width: 100%;
    border-radius: 6px;
    object-fit: cover;
  }
  .post-title {
    margin: 10px 0 5px;
    font-size: 1.1rem;
  }
  .post-excerpt {
    font-size: 0.9rem;
    color: #ccc;
  }
  .post-type {
    font-size: 0.85rem;
    color: #00aaff;
    margin-top: 5px;
  }
</style>
