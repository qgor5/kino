<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Детали фильма - TopKino</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #eee;
      margin: 0; padding: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    header, footer {
      text-align: center;
      padding: 15px 0;
      background: #222;
    }
    .movie-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .movie-poster img {
      width: 300px;
      border-radius: 8px;
    }
    .movie-details {
      flex: 1 1 400px;
    }
    h1 {
      margin-top: 0;
    }
    .overview {
      margin-top: 15px;
      line-height: 1.5;
    }
    .info {
      margin-top: 10px;
      font-size: 14px;
      color: #ccc;
    }
    iframe {
      margin-top: 20px;
      width: 100%;
      height: 360px;
      border: none;
      border-radius: 8px;
    }
    a.back-link {
      display: inline-block;
      margin-top: 20px;
      color: #39f;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>TopKino - Детали фильма</h1>
  </header>

  <a href="kino.html" class="back-link">&larr; Назад к списку фильмов</a>

  <div class="movie-container" id="movie-container">
    <!-- Здесь появится содержимое фильма -->
  </div>

  <footer>
    <small>© 2025 TopKino. Все права защищены.</small>
  </footer>

  <script>
    const API_KEY = '7cb67565ace3a08cd9d099c749787121';
    const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';

    function getMovieId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function fetchMovieDetails(id) {
      try {
        const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}&language=ru-RU`);
        if (!res.ok) throw new Error('Ошибка при загрузке данных фильма');
        const movie = await res.json();

        const resVideos = await fetch(`https://api.themoviedb.org/3/movie/${id}/videos?api_key=${API_KEY}&language=ru-RU`);
        const videosData = await resVideos.json();
        const trailer = videosData.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');

        displayMovie(movie, trailer);
      } catch (err) {
        document.getElementById('movie-container').innerHTML = `<p style="color:red;">${err.message}</p>`;
      }
    }

    function displayMovie(movie, trailer) {
      const container = document.getElementById('movie-container');
      container.innerHTML = `
        <div class="movie-poster">
          <img src="${movie.poster_path ? IMG_BASE_URL + movie.poster_path : 'https://via.placeholder.com/500x750?text=Нет+постера'}" alt="${movie.title}" />
        </div>
        <div class="movie-details">
          <h1>${movie.title} (${movie.release_date ? movie.release_date.slice(0,4) : '—'})</h1>
          <p class="overview">${movie.overview || 'Описание отсутствует.'}</p>
          <p class="info">
            <strong>Рейтинг:</strong> ${movie.vote_average} / 10 <br/>
            <strong>Жанры:</strong> ${movie.genres.map(g => g.name).join(', ')} <br/>
            <strong>Продолжительность:</strong> ${movie.runtime} минут
          </p>
          ${trailer ? `<iframe src="https://www.youtube.com/embed/${trailer.key}" allowfullscreen></iframe>` : '<p>Трейлер отсутствует.</p>'}
        </div>
      `;
    }

    const movieId = getMovieId();
    if (movieId) {
      fetchMovieDetails(movieId);
    } else {
      document.getElementById('movie-container').innerHTML = `<p style="color:red;">Не указан ID фильма.</p>`;
    }
  </script>
</body>
</html>