<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TopKino — Главная</title>
  <style>
    body {
      margin: 0; padding: 0; font-family: Arial, sans-serif; background: #111; color: #eee;
    }
    header {
      background: #222;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    header nav {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    header nav > div, header nav > a {
      cursor: pointer;
      position: relative;
      padding: 8px 12px;
      background: #333;
      border-radius: 6px;
      user-select: none;
      transition: background-color 0.3s;
      color: #00aaff;
      font-weight: bold;
    }
    header nav > div:hover, header nav > a:hover {
      background: #00aaff;
      color: #111;
    }
    /* Выпадающее меню */
    .dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: #222;
      min-width: 150px;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.7);
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
    }
    .dropdown-content div {
      padding: 8px 12px;
      cursor: pointer;
      color: #eee;
    }
    .dropdown-content div:hover {
      background: #00aaff;
      color: #111;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }

    /* Горизонтальная прокрутка жанров */
    .genres-scroll {
      margin: 10px 0;
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }
    .genres-scroll span {
      display: inline-block;
      padding: 6px 14px;
      margin-right: 10px;
      background: #333;
      border-radius: 20px;
      cursor: pointer;
      user-select: none;
      color: #00aaff;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .genres-scroll span:hover, .genres-scroll span.active {
      background: #00aaff;
      color: #111;
    }

    /* Сетка фильмов */
    #moviesGrid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .movie-card {
      width: 180px;
      background: #222;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: transform 0.2s;
      color: #eee;
      user-select: none;
    }
    .movie-card:hover {
      transform: translateY(-5px);
    }
    .movie-card img {
      width: 100%;
      height: 270px;
      object-fit: cover;
    }
    .movie-info {
      padding: 10px;
    }
    .movie-title {
      font-size: 1rem;
      margin: 0 0 6px 0;
    }
    .movie-date {
      font-size: 0.85rem;
      color: #aaa;
    }
  </style>
</head>
<body>

<header>
  <nav>
    <a href="#" id="nav-popular">Популярные фильмы</a>
    <div class="dropdown" id="nav-by-year">
      Фильмы по годам
      <div class="dropdown-content" id="year-list"></div>
    </div>
    <a href="#" id="nav-upcoming">Новинки фильмов</a>
    <a href="#" id="nav-tv">Сериалы</a>
    <a href="#" id="nav-animation">Мультфильмы</a>
  </nav>
</header>

<div class="genres-scroll" id="genresScroll"></div>

<main>
  <div id="moviesGrid"></div>
</main>

<script>
  const API_KEY = '7cb67565ace3a08cd9d099c749787121';
  const IMG_URL = 'https://image.tmdb.org/t/p/w300';

  // Загрузить жанры из API TMDb
  async function loadGenres() {
    const res = await fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${API_KEY}&language=ru-RU`);
    const data = await res.json();
    return data.genres;
  }

  // Создать горизонтальный список жанров
  async function renderGenres() {
    const genres = await loadGenres();
    const container = document.getElementById('genresScroll');
    container.innerHTML = '';
    genres.forEach(genre => {
      const span = document.createElement('span');
      span.textContent = genre.name;
      span.dataset.genreId = genre.id;
      span.onclick = () => loadMoviesByGenre(genre.id, genre.name, span);
      container.appendChild(span);
    });
  }

  // Загрузка фильмов по жанру
  async function loadMoviesByGenre(genreId, genreName, el) {
    setActiveGenre(el);
    const res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=ru-RU&with_genres=${genreId}&sort_by=popularity.desc&page=1`);
    const data = await res.json();
    renderMovies(data.results, `Жанр: ${genreName}`);
  }

  // Загрузка популярных фильмов
  async function loadPopularMovies() {
    setActiveNav('nav-popular');
    const res = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=ru-RU&page=1`);
    const data = await res.json();
    renderMovies(data.results, 'Популярные фильмы');
  }

  // Загрузка новинок фильмов
  async function loadUpcomingMovies() {
    setActiveNav('nav-upcoming');
    const res = await fetch(`https://api.themoviedb.org/3/movie/upcoming?api_key=${API_KEY}&language=ru-RU&page=1`);
    const data = await res.json();
    renderMovies(data.results, 'Новинки фильмов');
  }

  // Загрузка сериалов
  async function loadTVShows() {
    setActiveNav('nav-tv');
    const res = await fetch(`https://api.themoviedb.org/3/tv/popular?api_key=${API_KEY}&language=ru-RU&page=1`);
    const data = await res.json();
    renderMovies(data.results, 'Популярные сериалы', true);
  }

  // Загрузка мультфильмов (анимация)
  async function loadAnimations() {
    setActiveNav('nav-animation');
    const res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=ru-RU&with_genres=16&sort_by=popularity.desc&page=1`);
    const data = await res.json();
    renderMovies(data.results, 'Популярные мультфильмы');
  }

  // Загрузка фильмов по году
  async function loadMoviesByYear(year) {
    setActiveNav('nav-by-year');
    const res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=ru-RU&primary_release_year=${year}&sort_by=popularity.desc&page=1`);
    const data = await res.json();
    renderMovies(data.results, `Фильмы ${year} года`);
  }

  // Рендер фильмов на страницу
  function renderMovies(movies, sectionTitle, isTV = false) {
    const container = document.getElementById('moviesGrid');
    container.innerHTML = `<h2 style="width:100%; text-align:center; color:#00aaff;">${sectionTitle}</h2>`;

    movies.forEach(movie => {
      const title = isTV ? movie.name : movie.title;
      const date = movie.release_date || movie.first_air_date || '';
      const year = date.slice(0,4) || '';
      const slug = title.toLowerCase().replace(/[^a-zа-яё0-9]+/gi, '-');
      const link = `/${movie.id}-${slug}.html`;

      const card = document.createElement('div');
      card.className = 'movie-card';
      card.innerHTML = `
        <a href="${link}" style="color: inherit; text-decoration:none;">
          <img src="${movie.poster_path ? IMG_URL + movie.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" alt="${title}">
          <div class="movie-info">
            <h3 class="movie-title">${title} ${year ? '(' + year + ')' : ''}</h3>
            <p class="movie-date">${date}</p>
          </div>
        </a>
      `;
      container.appendChild(card);
    });
  }

  // Меняем активный жанр в списке
  function setActiveGenre(el) {
    document.querySelectorAll('#genresScroll span').forEach(span => span.classList.remove('active'));
    if (el) el.classList.add('active');
  }

  // Меняем активный пункт меню
  function setActiveNav(id) {
    document.querySelectorAll('header nav > a, header nav > div').forEach(el => el.classList.remove('active'));
    const el = document.getElementById(id);
    if (el) el.classList.add('active');
    setActiveGenre(null);
  }

  // Рендерим список годов в выпадающем меню
  function renderYearList() {
    const yearList = document.getElementById('year-list');
    yearList.innerHTML = '';
    const currentYear = new Date().getFullYear();
    for(let y = currentYear; y >= currentYear - 5; y--) {
      const div = document.createElement('div');
      div.textContent = y;
      div.onclick = () => loadMoviesByYear(y);
      yearList.appendChild(div);
    }
  }

  // Инициализация
  async function init() {
    await renderGenres();
    renderYearList();
    loadPopularMovies(); // по умолчанию загружаем популярные фильмы
  }

  init();

</script>

</body>
</html>
