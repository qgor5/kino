<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TopKino — Блог о кино, новости и обзоры</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      margin: 20px;
    }
    main {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .post-card {
      background: #222;
      border-radius: 8px;
      width: 280px;
      overflow: hidden;
      box-shadow: 0 0 10px #00aaff44;
      text-decoration: none;
      color: #eee;
      display: flex;
      flex-direction: column;
    }
    .post-card:hover {
      box-shadow: 0 0 15px #00aaffaa;
    }
    .post-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: #333;
    }
    .post-title {
      font-size: 1.2rem;
      padding: 10px;
      flex-grow: 1;
    }
    .post-description {
      font-size: 0.9rem;
      padding: 0 10px 10px;
      color: #ccc;
    }
  </style>
</head>
<body>

<main id="posts-container" aria-label="Список статей блога">
  <!-- Здесь появятся карточки -->
</main>

<script>
  // Список статей с URL
  const articles = [
    { url: 'https://topkino.netlify.app/blog/karate-kid-2025.html' },
    { url: 'https://topkino.netlify.app/blog/some-other-article.html' }
  ];

  async function loadArticleMeta(url) {
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Ошибка загрузки: ${url}`);
      const text = await res.text();

      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');

      const title = doc.querySelector('meta[property="og:title"]')?.content
                    || doc.querySelector('title')?.textContent
                    || 'Без названия';

      const description = doc.querySelector('meta[name="description"]')?.content
                          || doc.querySelector('meta[property="og:description"]')?.content
                          || 'Описание отсутствует';

      let image = doc.querySelector('meta[property="og:image"]')?.content;

      if (!image) {
        const firstImg = doc.querySelector('article img, main img, img');
        if (firstImg) {
          image = firstImg.src || firstImg.getAttribute('src');
        }
      }

      if (!image) {
        image = 'https://via.placeholder.com/280x160?text=No+Image';
      }

      return { title, description, image, url };
    } catch (e) {
      console.error('Ошибка загрузки статьи:', url, e);
      return null;
    }
  }

  async function renderPosts() {
    const container = document.getElementById('posts-container');
    for (const article of articles) {
      const meta = await loadArticleMeta(article.url);
      if (!meta) continue;

      const a = document.createElement('a');
      a.href = meta.url;
      a.className = 'post-card';
      a.title = meta.title;

      a.innerHTML = `
        <img src="${meta.image}" alt="Изображение статьи: ${meta.title}" class="post-image" loading="lazy" />
        <h2 class="post-title">${meta.title}</h2>
        <p class="post-description">${meta.description}</p>
      `;

      container.appendChild(a);
    }
  }

  renderPosts();
</script>

</body>
</html>
